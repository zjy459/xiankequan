
<!-- è¯„è®ºæ¿å— -->
<view class="post-list">
  <block wx:for="{{posts}}" wx:key="_id">
    <view class="post-item">
      <view class="nickname">{{usersMap[item.userId].nickname}}</view>
      <view class="content">
        <text class="item-title">{{item.title}}</text>
      </view>
      <view class="post-footer">
        <view class="time">{{item.createTime}}</view>
        <view class="actions">
          <button size="mini" bindtap="onLike" data-id="{{item._id}}">â¤ {{item.likeCount}}</button>
          <button size="mini" bindtap="onComment" data-id="{{item._id}}">ğŸ’¬ {{item.commentCount}}</button>
        </view>
      </view>

      <!-- è¯„è®ºå±•ç¤º -->
      <view wx:if="{{item.commentCount > 0}}" class="comment-panel">
        <block wx:for="{{commentsMap[item._id]}}" wx:for-item="comment" wx:for-index="commentIdx" wx:key="_id">
          <view wx:if="{{commentIdx < 3}}" class="comment-row">
            <text class="comment-author">{{usersMap[comment.userId].nickname}}</text>
            <text class="comment-content">{{comment.content}}</text>
          </view>
          <view wx:if="{{commentIdx >=3}}" class="comment-count-row" bindtap="onCommentDetail" data-id="{{item._id}}">
          å…±{{commentIdx}}æ¡è¯„è®º>
        </view>
        </block>
      </view>
    </view>
  </block>
</view>


<!-- è¯„è®ºå¼¹çª— -->
<view wx:if="{{showCommentModal}}">
  <view class="modal-mask" bindtap="closeCommentModal"></view>
  <view class="modal-content {{modalAnimation}}">
    <!-- é¡¶éƒ¨æ‹–æ‹½æ¡å’Œæ ‡é¢˜ä»…åœ¨è¯¦æƒ…å¼¹çª—æ˜¾ç¤º -->
    <view wx:if="{{modalType === 'detail'}}">
      <view class="modal-bar"></view>
      <view class="modal-title">è¯„è®º {{commentDetailCount}}</view>
    </view>
    <!-- è¯„è®ºè¯¦æƒ…ï¼Œä»…åœ¨è¯¦æƒ…å¼¹çª—æ˜¾ç¤º -->
    <scroll-view wx:if="{{modalType === 'detail'}}" scroll-y class="comment-scroll">
      <block wx:for="{{commentDetailList}}" wx:key="_id">
        <view class="comment-row">
          <view class="comment-main">
            <view class="comment-header">
              <text class="comment-author">{{usersMap[item.userId].nickname}}</text>
            </view>
            <view class="comment-content">
              <text wx:if="{{item.replyToUserId}}">å›å¤ {{usersMap[item.replyToUserId].nickname}}ï¼š</text>
              <text>{{item.content}}</text>
            </view>
            <view class="comment-meta">
              <text class="comment-time">{{item.createTime}}</text>
              <text class="comment-reply-btn" bindtap="onReply" data-id="{{item._id}}">å›å¤</text>
            </view>
          </view>
          <view class="comment-like-btn">
            <icon type="heart" size="24" color="#ccc"></icon>
          </view>
        </view>
      </block>
      <view class="no-more">
        - æš‚æ— æ›´å¤šè¯„è®º -
      </view>
    </scroll-view>
    <!-- è¾“å…¥æ¡†å’Œ action rowï¼ˆä¸¤ç§å¼¹çª—éƒ½æ˜¾ç¤ºï¼Œfocusæ¡ä»¶ä¸åŒï¼‰ -->
    <view class="modal-bottom">
      <textarea
        class="modal-input"
        placeholder="å‘è¨€è¦å‹å–„ï¼Œç•…èŠä¸å¼•æˆ˜"
        auto-height
        focus="{{modalType === 'input' ? showCommentModal : inputFocus}}"
        bindinput="onCommentInput"
        value="{{commentContent}}"
      ></textarea>
      <view class="action-row">
        <view class="icon-group">
          <image class="action-icon" src="/images/icons/ai_te.png" mode="aspectFit" />
          <image class="action-icon" src="/images/icons/picture.png" mode="aspectFit" />
        </view>
        <button class="send-btn" bindtap="sendComment">å‘é€</button>
      </view>
    </view>
  </view>
</view>